<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Fish Adventure: Extreme Boss Fix - By Chayanan</title>
    <style>
        body { margin: 0; padding: 0; display: flex; justify-content: center; align-items: center; height: 100vh; background-color: #e0f7fa; font-family: 'Tahoma', sans-serif; overflow: hidden; touch-action: none; }
        #game-container { position: relative; width: 100vw; height: 100vh; max-width: 800px; max-height: 600px; overflow: hidden; box-shadow: 0 0 50px rgba(0,0,0,0.3); border: 2px solid #fff; }
        canvas { background: linear-gradient(#4fc3f7, #01579b); display: block; width: 100%; height: 100%; }
        #status-alert { position: absolute; left: 50%; transform: translateX(-50%); color: #ffeb3b; font-weight: bold; text-shadow: 2px 2px #000; z-index: 5; text-align: center; pointer-events: none; width: 90%; line-height: 1.2; top: 20px; font-size: 24px; }
        .overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: flex; flex-direction: column; justify-content: center; align-items: center; background: rgba(0, 0, 0, 0.85); color: white; z-index: 10; text-align: center; padding: 20px; box-sizing: border-box; }
        .hidden { display: none !important; }
        .menu-btn { padding: 12px 30px; margin: 8px; font-size: 18px; cursor: pointer; border: none; border-radius: 50px; background: #ffeb3b; color: #01579b; font-weight: bold; box-shadow: 0 5px #fbc02d; }
        .hp-bar-container { position: absolute; top: 15px; right: 15px; width: 120px; height: 20px; background: #333; border-radius: 15px; border: 2px solid white; overflow: hidden; z-index: 6; }
        #hp-fill { width: 100%; height: 100%; background: #4caf50; transition: 0.1s; }
        #score-display { position: absolute; top: 15px; left: 15px; color: white; font-weight: bold; font-size: 24px; text-shadow: 2px 2px #0277bd; z-index: 6; }
        #boss-ui { position: absolute; bottom: 30px; left: 50%; transform: translateX(-50%); width: 80%; height: 12px; background: #333; border: 2px solid white; border-radius: 10px; display: none; }
        #boss-hp-fill { width: 100%; height: 100%; background: #ff1744; }
    </style>
</head>
<body>

<div id="game-container">
    <canvas id="gameCanvas" width="800" height="600"></canvas>
    <div id="score-display">‡πÅ‡∏ï‡πâ‡∏°: 0</div>
    <div id="status-alert">‡∏™‡∏∞‡∏™‡∏°‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏õ‡∏™‡∏π‡πâ‡∏ö‡∏≠‡∏™!</div>
    <div class="hp-bar-container"><div id="hp-fill"></div></div>
    <div id="boss-ui"><div id="boss-hp-fill"></div></div>

    <div id="main-menu" class="overlay">
        <h1>FISH ADVENTURE</h1>
        <p>‡∏™‡∏∞‡∏™‡∏°‡πÅ‡∏ï‡πâ‡∏°‡∏ñ‡∏∂‡∏á 5,000 ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏™‡∏π‡πâ‡∏ö‡∏≠‡∏™!</p>
        <button class="menu-btn" onclick="startGame()">‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°</button>
        <button class="menu-btn" onclick="showCredits()">‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏ó‡∏≥</button>
    </div>

    <div id="credits-menu" class="overlay hidden">
        <h2>‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏à‡∏±‡∏î‡∏ó‡∏≥</h2>
        <p>‡∏î.‡∏ä.‡∏ä‡∏ç‡∏≤‡∏ô‡∏±‡∏ô‡∏ï‡πå ‡πÄ‡∏î‡∏ä‡∏ß‡∏á‡∏©‡∏≤ ‡∏°.2/4 ‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà 1</p>
        <button class="menu-btn" onclick="showMainMenu()">‡∏Å‡∏•‡∏±‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</button>
    </div>

    <div id="game-over" class="overlay hidden">
        <h2 style="font-size: 32px; color: #ff5252;">GAME OVER</h2>
        <p id="final-score" style="font-size: 20px; margin-bottom: 20px;"></p>
        <button class="menu-btn" onclick="startGame()">‡πÄ‡∏•‡πà‡∏ô‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á</button>
        <button class="menu-btn" onclick="showMainMenu()">‡∏Å‡∏•‡∏±‡∏ö‡∏™‡∏π‡πà‡πÄ‡∏°‡∏ô‡∏π‡∏´‡∏•‡∏±‡∏Å</button>
    </div>
</div>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const hpFill = document.getElementById('hp-fill');
    const bossUi = document.getElementById('boss-ui');
    const bossHpFill = document.getElementById('boss-hp-fill');
    const scoreDisplay = document.getElementById('score-display');
    const statusAlert = document.getElementById('status-alert');
    
    let gameRunning = false, score = 0, hp = 100, items = [], explosions = [], lastHungerUpdate = 0;
    let poisonTimer = 0, bossDefeated = false, bossBullets = []; 
    
    const player = { x: 400, y: 150, targetX: 400, targetY: 150, facing: 1 };
    
    const boss = { 
        active: false, x: 400, y: 800, hp: 50000, maxHp: 50000, 
        freezeTime: 0, attackTimer: 0, state: 'idle', warningX: -500, targetX: 400
    };

    const AudioContext = window.AudioContext || window.webkitAudioContext;
    const audioCtx = new AudioContext();

    function playSound(freq, type, duration, vol=0.08) {
        if (audioCtx.state === 'suspended') audioCtx.resume();
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.type = type; osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
        gain.gain.setValueAtTime(vol, audioCtx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + duration);
        osc.connect(gain); gain.connect(audioCtx.destination);
        osc.start(); osc.stop(audioCtx.currentTime + duration);
    }

    // --- ‡∏™‡πà‡∏ß‡∏ô‡∏ß‡∏≤‡∏î‡πÇ‡∏°‡πÄ‡∏î‡∏•‡∏ó‡∏µ‡πà‡∏´‡∏≤‡∏¢‡πÑ‡∏õ ---
    function drawClassicMine(x, y, radius, isBig) {
        ctx.save();
        ctx.fillStyle = isBig ? '#1a1a1a' : '#333';
        ctx.beginPath(); ctx.arc(x, y, radius, 0, Math.PI * 2); ctx.fill();
        ctx.strokeStyle = ctx.fillStyle; ctx.lineWidth = isBig ? 6 : 4;
        for (let a = 0; a < Math.PI * 2; a += Math.PI / 4) {
            ctx.beginPath(); ctx.moveTo(x, y);
            ctx.lineTo(x + Math.cos(a) * (radius + (isBig ? 15 : 10)), y + Math.sin(a) * (radius + (isBig ? 15 : 10)));
            ctx.stroke();
        }
        ctx.fillStyle = (Math.floor(Date.now() / 200) % 2 === 0) ? 'red' : '#300';
        ctx.beginPath(); ctx.arc(x, y, radius / 3, 0, Math.PI * 2); ctx.fill();
        ctx.restore();
    }

    function drawJellyfish(x, y) {
        ctx.save(); 
        let move = Math.sin(Date.now() * 0.005) * 10;
        ctx.fillStyle = 'rgba(234, 128, 252, 0.8)'; 
        ctx.beginPath(); ctx.arc(x, y + move, 22, Math.PI, 0); ctx.fill();
        ctx.strokeStyle = 'rgba(234, 128, 252, 0.6)'; ctx.lineWidth = 3;
        for(let i = -15; i <= 15; i += 10) {
            ctx.beginPath(); ctx.moveTo(x + i, y + move);
            let tentacleSwing = Math.sin(Date.now() * 0.01 + i) * 12;
            ctx.bezierCurveTo(x + i + tentacleSwing, y + move + 15, x + i - tentacleSwing, y + move + 30, x + i, y + move + 45);
            ctx.stroke();
        }
        ctx.restore();
    }
    // -------------------------

    function createOldExplosion(x, y) {
        explosions.push({ x, y, r: 10, alpha: 1 });
        playSound(60, 'sawtooth', 0.5, 0.25);
        if (boss.active) {
            let dist = Math.sqrt((x - boss.x)**2 + (y - (boss.y + 50))**2);
            if (dist < 320) {
                boss.hp -= 800;
                bossHpFill.style.width = (boss.hp / boss.maxHp * 100) + '%';
            }
        }
    }

    const updateInput = (e) => {
        if (audioCtx.state === 'suspended') audioCtx.resume();
        const rect = canvas.getBoundingClientRect();
        const clientX = (e.touches ? e.touches[0].clientX : e.clientX);
        const clientY = (e.touches ? e.touches[0].clientY : e.clientY);
        player.targetX = (clientX - rect.left) * (canvas.width / rect.width);
        player.targetY = (clientY - rect.top) * (canvas.height / rect.height);
        if (player.targetX > player.x) player.facing = 1; else player.facing = -1;
    };
    
    canvas.addEventListener('mousemove', updateInput);
    canvas.addEventListener('touchmove', (e) => { e.preventDefault(); updateInput(e); }, { passive: false });

    function startGame() {
        if (audioCtx.state === 'suspended') audioCtx.resume();
        document.querySelectorAll('.overlay').forEach(el => el.classList.add('hidden'));
        gameRunning = true; score = 0; hp = 100; items = []; explosions = []; bossBullets = [];
        boss.active = false; boss.hp = 50000; boss.y = 800; bossDefeated = false; 
        boss.freezeTime = 0; boss.state = 'idle'; boss.targetX = 400;
        bossUi.style.display = 'none'; poisonTimer = 0;
        player.x = 400; player.y = 150;
        lastHungerUpdate = Date.now();
        statusAlert.innerText = "‡∏™‡∏∞‡∏™‡∏°‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏õ‡∏™‡∏π‡πâ‡∏ö‡∏≠‡∏™!";
        statusAlert.style.color = "#ffeb3b";
        updateHPUI();
        scoreDisplay.innerText = `‡πÅ‡∏ï‡πâ‡∏°: 0`;
        requestAnimationFrame(animate);
    }

    function showMainMenu() { document.querySelectorAll('.overlay').forEach(el => el.classList.add('hidden')); document.getElementById('main-menu').classList.remove('hidden'); gameRunning = false; }
    function showCredits() { document.getElementById('main-menu').classList.add('hidden'); document.getElementById('credits-menu').classList.remove('hidden'); }

    function updateHPUI() {
        hpFill.style.width = Math.max(0, hp) + '%';
        hpFill.style.background = poisonTimer > 0 ? "#ea80fc" : (hp > 60 ? '#4caf50' : (hp > 30 ? '#ffeb3b' : '#ff5252'));
        if (hp <= 0 && gameRunning) gameOver();
    }

    function gameOver() { gameRunning = false; document.getElementById('game-over').classList.remove('hidden'); document.getElementById('final-score').innerText = `‡πÅ‡∏ï‡πâ‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏∑‡∏≠: ${score}`; }

    function drawFish(x, y, color = '#ff9800', sizeScale = 1, facing = 1) {
        ctx.save(); ctx.translate(x, y); if (facing === -1) ctx.scale(-1, 1);
        ctx.fillStyle = (poisonTimer > 0 && color === '#ff9800') ? '#ea80fc' : color;
        ctx.beginPath(); ctx.ellipse(0, 0, 30*sizeScale, 20*sizeScale, 0, 0, Math.PI * 2); ctx.fill();
        ctx.beginPath(); ctx.moveTo(-25*sizeScale, 0); ctx.lineTo(-45*sizeScale, -15*sizeScale); ctx.lineTo(-45*sizeScale, 15*sizeScale); ctx.closePath(); ctx.fill();
        ctx.fillStyle = 'white'; ctx.beginPath(); ctx.arc(15*sizeScale, -5*sizeScale, 5*sizeScale, 0, Math.PI*2); ctx.fill();
        ctx.fillStyle = 'black'; ctx.beginPath(); ctx.arc(17*sizeScale, -5*sizeScale, 2*sizeScale, 0, Math.PI*2); ctx.fill();
        ctx.restore();
    }

    function drawBoss() {
        if (!boss.active) return;
        ctx.save();
        ctx.strokeStyle = '#8b0000'; ctx.lineWidth = 18;
        for(let i=0; i<3; i++) {
            let legMove = Math.sin(Date.now() * 0.01 + i) * 20;
            [-1, 1].forEach(side => {
                ctx.beginPath(); ctx.moveTo(boss.x + (side * 90), boss.y + 30);
                ctx.lineTo(boss.x + (side * 230) + legMove, boss.y + 130); ctx.stroke();
            });
        }
        [-1, 1].forEach(side => {
            ctx.save(); ctx.translate(boss.x + (side * 170), boss.y); ctx.scale(side, 1);
            let isSmashingSide = (boss.state === 'smashing' && (boss.warningX === (side === -1 ? 150 : 650) || boss.warningX === 400));
            let armRotate = isSmashingSide ? 1.0 : -0.3;
            ctx.rotate(armRotate + Math.sin(Date.now()*0.003)*0.1);
            if (isSmashingSide && boss.attackTimer < 40) {
                ctx.fillStyle = (Math.floor(Date.now()/50) % 2 === 0) ? 'yellow' : 'red';
            } else { ctx.fillStyle = '#b71c1c'; }
            ctx.beginPath(); ctx.moveTo(0,0); ctx.quadraticCurveTo(50, -130, 170, -70); 
            ctx.lineTo(150, -30); ctx.lineTo(130, -50); ctx.lineTo(110, -20); ctx.closePath(); ctx.fill();
            ctx.beginPath(); ctx.moveTo(0,0); ctx.quadraticCurveTo(50, 60, 160, 20); ctx.lineTo(130, -10); ctx.closePath(); ctx.fill();
            ctx.restore();
        });
        ctx.fillStyle = '#8b0000';
        ctx.beginPath(); ctx.ellipse(boss.x, boss.y + 50, 230, 140, 0, 0, Math.PI * 2); ctx.fill();
        ctx.fillStyle = 'white'; ctx.beginPath(); ctx.arc(boss.x-70, boss.y, 40, 0, Math.PI*2); ctx.fill();
        ctx.fillStyle = 'black'; ctx.beginPath(); ctx.arc(boss.x-70, boss.y-10, 18, 0, Math.PI*2); ctx.fill();
        ctx.fillStyle = 'white'; ctx.beginPath(); ctx.arc(boss.x+70, boss.y, 40, 0, Math.PI*2); ctx.fill();
        ctx.fillStyle = 'black'; ctx.beginPath(); ctx.arc(boss.x+70, boss.y-10, 18, 0, Math.PI*2); ctx.fill();
        ctx.restore();
    }

    function checkSmashHit(wx) {
        if (player.x > wx - 120 && player.x < wx + 120) {
            hp -= 40; updateHPUI(); playSound(150, 'sawtooth', 0.3, 0.2);
        }
    }

    function animate() {
        if (!gameRunning) return;
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        let now = Date.now();

        if (boss.active) {
            statusAlert.innerText = "üí¢ ‡∏ö‡∏≠‡∏™‡∏õ‡∏π‡∏Ñ‡∏•‡∏±‡πà‡∏á! HP 50,000 (‡∏£‡∏∞‡∏ß‡∏±‡∏á‡∏ó‡πà‡∏≤‡∏ü‡∏≤‡∏î‡∏Å‡πâ‡∏≤‡∏°!)";
            statusAlert.style.color = "#ff1744";
        } else if (bossDefeated) {
            statusAlert.innerText = "‡∏™‡∏∞‡∏™‡∏°‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏≠‡∏¢‡∏π‡πà‡∏£‡∏≠‡∏î"; statusAlert.style.color = "#4caf50";
        } else {
            if (score >= 2000) { statusAlert.innerText = "üëæ ‡∏£‡∏∞‡∏ß‡∏±‡∏á‡πÅ‡∏°‡∏á‡∏Å‡∏∞‡∏û‡∏£‡∏∏‡∏ô‡∏û‡∏¥‡∏©!"; statusAlert.style.color = "#ea80fc"; }
            else if (score >= 1000) { statusAlert.innerText = "üí£ ‡∏£‡∏∞‡∏ß‡∏±‡∏á‡∏ó‡∏∏‡πà‡∏ô‡∏£‡∏∞‡πÄ‡∏ö‡∏¥‡∏î‡∏¢‡∏±‡∏Å‡∏©‡πå!"; statusAlert.style.color = "#ff5252"; }
            else if (score >= 500) { statusAlert.innerText = "‚ö†Ô∏è ‡∏£‡∏∞‡∏ß‡∏±‡∏á‡∏ó‡∏∏‡πà‡∏ô‡∏£‡∏∞‡πÄ‡∏ö‡∏¥‡∏î‡πÅ‡∏•‡∏∞‡∏Ç‡∏¢‡∏∞!"; statusAlert.style.color = "#ffffff"; }
            else { statusAlert.innerText = "‡∏™‡∏∞‡∏™‡∏°‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÑ‡∏õ‡∏™‡∏π‡πâ‡∏ö‡∏≠‡∏™!"; statusAlert.style.color = "#ffeb3b"; }
        }

        if (boss.active && boss.freezeTime > 0) {
            boss.freezeTime--; if (boss.y > 450) boss.y -= 2;
            ctx.fillStyle = "white"; ctx.font = "bold 40px Tahoma"; ctx.textAlign = "center";
            ctx.fillText("!!! MEGA BOSS CRAB HP 50,000 !!!", 400, 200);
            drawBoss(); drawFish(player.x, player.y, '#ff9800', 1, player.facing);
            requestAnimationFrame(animate); return;
        }

        if (now - lastHungerUpdate > 1000) { hp -= 3; updateHPUI(); lastHungerUpdate = now; }
        if (poisonTimer > 0) { hp -= 0.5; poisonTimer--; updateHPUI(); }

        player.x += (player.targetX - player.x) * 0.12;
        player.y += (player.targetY - player.y) * 0.12;

        if (Math.random() < 0.12) {
            let r = Math.random(), type = 'food';
            if (r < 0.12) type = 'trash';
            else if (r < 0.22) type = 'worm';
            else if (r < 0.32) type = 'small_fish';
            else if (r < 0.65) {
                if (score >= 500) {
                    let rDanger = Math.random();
                    if (score >= 2000 && rDanger < 0.25) type = 'jellyfish';
                    else if (score >= 1000 && rDanger < 0.5) type = 'big_mine';
                    else type = 'mine'; 
                }
            }
            items.push({ x: Math.random()*740+30, y: -50, type, speed: (Math.random()*2+3) });
        }

        if (score >= 5000 && !boss.active && !bossDefeated) { 
            boss.active = true; bossUi.style.display = 'block'; boss.freezeTime = 180; boss.x = 400; boss.y = 800;
        }

        if (boss.active) {
            boss.attackTimer++;
            if (boss.state === 'idle' && boss.attackTimer > 60) {
                let r = Math.random();
                if (r < 0.7) { 
                    boss.state = 'moving';
                    let pos = Math.random();
                    if (pos < 0.33) boss.targetX = 150; 
                    else if (pos < 0.66) boss.targetX = 400; 
                    else boss.targetX = 650;
                } else { boss.state = 'smashing'; }
                boss.attackTimer = 0;
            }
            
            if (boss.state === 'moving') {
                boss.x += (boss.targetX - boss.x) * 0.08;
                if (Math.abs(boss.x - boss.targetX) < 5) {
                    boss.state = 'shooting'; boss.attackTimer = 0;
                }
            } else if (boss.state === 'shooting') {
                if (boss.attackTimer % 2 === 0) {
                    for(let offset = -100; offset <= 100; offset += 40) {
                        bossBullets.push({x: boss.x + offset, y: boss.y - 20, vx: (Math.random()-0.5)*3, vy: -15, r: 10});
                    }
                    playSound(1100, 'sine', 0.05, 0.03);
                }
                if (boss.attackTimer > 80) boss.state = 'idle';
            } else if (boss.state === 'smashing') {
                if (boss.attackTimer === 41) { createOldExplosion(150, 300); checkSmashHit(150); }
                if (boss.attackTimer === 91) { createOldExplosion(650, 300); checkSmashHit(650); }
                if (boss.attackTimer === 141) { createOldExplosion(400, 300); checkSmashHit(400); }
                if (boss.attackTimer > 160) { boss.state = 'idle'; boss.warningX = -500; }
                boss.warningX = boss.attackTimer < 50 ? 150 : (boss.attackTimer < 100 ? 650 : 400);
            }
        }

        if (boss.state === 'smashing' && boss.attackTimer % 10 < 5) {
            ctx.fillStyle = (Math.floor(Date.now()/50) % 2 === 0) ? 'rgba(255, 255, 0, 0.25)' : 'rgba(255, 0, 0, 0.25)';
            ctx.fillRect(boss.warningX - 120, 0, 240, 600);
        }

        bossBullets.forEach((b, i) => {
            b.y += b.vy; b.x += b.vx;
            ctx.fillStyle = 'white'; ctx.beginPath(); ctx.arc(b.x, b.y, b.r, 0, Math.PI*2); ctx.fill();
            if (Math.sqrt((player.x-b.x)**2+(player.y-b.y)**2) < b.r + 25) { 
                hp -= 8; updateHPUI(); bossBullets.splice(i, 1); playSound(100, 'square', 0.1);
            }
            if (b.y < -50) bossBullets.splice(i, 1);
        });

        explosions.forEach((e, i) => {
            ctx.save(); ctx.strokeStyle = `rgba(255, 255, 255, ${e.alpha})`; ctx.lineWidth = 6;
            ctx.beginPath(); ctx.arc(e.x, e.y, e.r, 0, Math.PI*2); ctx.stroke();
            e.r += 12; e.alpha -= 0.04;
            if (e.alpha <= 0) explosions.splice(i, 1); ctx.restore();
        });

        for (let i = items.length - 1; i >= 0; i--) {
            let item = items[i]; item.y += item.speed;
            
            // --- ‡∏ß‡∏≤‡∏î‡πÑ‡∏≠‡πÄ‡∏ó‡∏°‡∏î‡πâ‡∏ß‡∏¢‡πÇ‡∏°‡πÄ‡∏î‡∏•‡πÄ‡∏î‡∏¥‡∏° ---
            if (item.type === 'food') { ctx.fillStyle = '#ffeb3b'; ctx.beginPath(); ctx.arc(item.x, item.y, 8, 0, Math.PI*2); ctx.fill(); }
            else if (item.type === 'worm') { ctx.fillStyle = '#ff80ab'; ctx.fillRect(item.x-15, item.y-5, 30, 10); }
            else if (item.type === 'small_fish') { drawFish(item.x, item.y, '#00e5ff', 0.6, 1); }
            else if (item.type === 'trash') { ctx.fillStyle = '#9e9e9e'; ctx.fillRect(item.x-12, item.y-12, 24, 24); }
            else if (item.type.includes('mine')) { drawClassicMine(item.x, item.y, item.type === 'big_mine' ? 30 : 15, item.type === 'big_mine'); }
            else if (item.type === 'jellyfish') { drawJellyfish(item.x, item.y); }
            // -------------------------

            // ‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏≠‡∏™‡∏Å‡∏ß‡∏≤‡∏î‡∏•‡πâ‡∏≤‡∏á‡πÑ‡∏≠‡πÄ‡∏ó‡∏°
            if (boss.active) {
                let distToBossBody = Math.sqrt((item.x - boss.x)**2 + (item.y - (boss.y + 50))**2);
                if (distToBossBody < 220) {
                    if (item.type.includes('mine')) { createOldExplosion(item.x, item.y); }
                    items.splice(i, 1); continue; 
                }
            }

            if (Math.sqrt((player.x - item.x)**2 + (player.y - item.y)**2) < 45) {
                if (item.type.includes('mine')) { createOldExplosion(item.x, item.y); hp -= (item.type === 'big_mine' ? 50 : 30); }
                else if (item.type === 'food') { score += 10; hp = Math.min(100, hp + 5); playSound(600, 'sine', 0.1); }
                else if (item.type === 'worm') { score += 25; hp = Math.min(100, hp + 15); playSound(700, 'sine', 0.1); }
                else if (item.type === 'small_fish') { score += 100; hp = Math.min(100, hp + 40); playSound(900, 'sine', 0.1); }
                else if (item.type === 'trash') { hp -= 15; playSound(100, 'square', 0.2); }
                else if (item.type === 'jellyfish') { poisonTimer = 150; playSound(300, 'square', 0.4); }
                items.splice(i, 1); scoreDisplay.innerText = `‡πÅ‡∏ï‡πâ‡∏°: ${score}`; updateHPUI(); continue;
            }
            if (item.y > 650) items.splice(i, 1);
        }

        drawBoss(); drawFish(player.x, player.y, '#ff9800', 1, player.facing);
        if (boss.active && boss.hp <= 0) { 
            boss.active = false; bossDefeated = true; bossUi.style.display = 'none'; score += 10000; 
            statusAlert.innerText = "‡∏™‡∏∞‡∏™‡∏°‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏≠‡∏¢‡∏π‡πà‡∏£‡∏≠‡∏î"; statusAlert.style.color = "#4caf50";
        }
        requestAnimationFrame(animate);
    }
</script>
</body>
</html>
